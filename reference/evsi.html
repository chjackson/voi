<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculate the expected value of sample information from a decision-analytic
model"><title>Calculate the expected value of sample information from a decision-analytic
model — evsi • voi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate the expected value of sample information from a decision-analytic
model — evsi"><meta property="og:description" content="Calculate the expected value of sample information from a decision-analytic
model"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">voi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/voi.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/book.html">Value of Information for Health Economic Evaluations: book code resources</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate the expected value of sample information from a decision-analytic
model</h1>
      
      <div class="d-none name"><code>evsi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate the expected value of sample information from a decision-analytic
model</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">evsi</span><span class="op">(</span></span>
<span>  <span class="va">outputs</span>,</span>
<span>  <span class="va">inputs</span>,</span>
<span>  study <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  datagen_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pars_datagen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  aux_pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  likelihood <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  analysis_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  analysis_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  par_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Q <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  npreg_method <span class="op">=</span> <span class="st">"gam"</span>,</span>
<span>  nsim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>outputs</dt>
<dd><p>This could take one of two forms</p>
<p>"net benefit" form: a matrix or data frame of samples from the uncertainty
distribution of the expected net benefit.  The number of rows should equal
the number of samples, and the number of columns should equal the number
of decision options.</p>
<p>"cost-effectiveness analysis" form: a list with the following named
components:</p>
<p><code>"c"</code>: a matrix or data frame of samples from the distribution of
costs.  There should be one column for each decision option.</p>
<p><code>"e"</code>: a matrix or data frame of samples from the distribution of
effects, likewise.</p>
<p><code>"k"</code>: a vector of willingness-to-pay values.</p>
<p>Objects of class <code>"bcea"</code>, as created by the <span class="pkg">BCEA</span> package, are in
this "cost-effectiveness analysis" format, therefore they may be supplied as
the <code>outputs</code> argument.</p>
<p>If <code>outputs</code> is a matrix or data frame, it is assumed to be of "net
benefit" form.  Otherwise if it is a list, it is assumed to be of "cost
effectiveness analysis" form.</p></dd>


<dt>inputs</dt>
<dd><p>Matrix or data frame of samples from the uncertainty
distribution of the input parameters of the decision model.   The number
of columns should equal the number of parameters, and the columns should
be named.    This should have the same number of rows as there are samples
in <code>outputs</code>, and each row of the samples in <code>outputs</code> should
give the model output evaluated at the corresponding parameters.</p></dd>


<dt>study</dt>
<dd><p>Name of one of the built-in study types supported by this
package for EVSI calculation.  If this is supplied, then the columns of
<code>inputs</code> that correspond to the parameters governing the study data
should be identified in <code>pars</code>.</p>
<p>Current built-in studies are</p>
<p><code>"binary"</code> A study with a binary outcome observed on one sample of
individuals.   Requires one parameter: the probability of the outcome. The
sample size is specifed in the <code>n</code> argument to <code>evsi()</code>, and the
binomially-distributed outcome is named <code>X1</code>.</p>
<p><code>"trial_binary"</code> Two-arm trial with a binary outcome.   Requires two
parameters: the probability of the outcome in arm 1 and 2 respectively.
The sample size is the same in each arm, specifed in the <code>n</code> argument
to <code>evsi()</code>, and the binomial outcomes are named <code>X1</code> and
<code>X2</code> respectively.</p>
<p><code>"normal_known"</code> A study of a normally-distributed outcome, with a
known standard deviation, on one sample of individuals.  Likewise the
sample size is specified in the <code>n</code> argument to <code>evsi()</code>.  The
standard deviation defaults to 1, and can be changed by specifying
<code>sd</code> as a component of the <code>aux_pars</code> argument, e.g.
<code>evsi(..., aux_pars=list(sd=2))</code>.</p>
<p>Either <code>study</code> or <code>datagen_fn</code> should be supplied to
<code>evsi()</code>.</p></dd>


<dt>datagen_fn</dt>
<dd><p>If the proposed study is not one of the built-in types
supported, it can be specified in this argument as an R function to sample
predicted data from the study.  This function should have the following
specification:</p><ol><li><p>the function's first argument should be a data frame of parameter
simulations, with one row per simulation and one column per parameter.
The parameters in this data frame must all be found in <code>inputs</code>.</p></li>
<li><p>the function should return a data frame.</p></li>
<li><p>the returned data frame should have number of rows equal to the number
of parameter simulations in <code>inputs</code>.</p></li>
<li><p>if <code>inputs</code> is considered as a sample from the posterior, then
<code>datagen_fn(inputs)</code> returns a corresponding sample from the
posterior predictive distribution, which includes two sources of
uncertainty: (a) uncertainty about the parameters and (b) sampling
variation in observed data given fixed parameter values.</p></li>
<li><p>the function can optionally have more than one argument. If so, these
additional arguments should be given default values in the definition of
<code>datagen_fn</code>.  If there is an argument called <code>n</code>, then it is
interpreted as the sample size for the proposed study.</p></li>
</ol></dd>


<dt>pars</dt>
<dd><p>Character vector identifying which parameters are learned from the proposed study.
These should be columns of <code>inputs</code>.</p>
<p>This is required for the methods which involve an
intermediate EVPPI calculation, that is, <code>method="is"</code> and
<code>method="mm"</code>.  It should consist of the variables used in the
definition of <code>datagen_fn</code> (and <code>likelihood</code>, <code>analysis_fn</code>
and <code>model_fn</code>, if these are used) and only these variables.</p></dd>


<dt>pars_datagen</dt>
<dd><p>Character vector identifying which columns of <code>inputs</code> are
the parameters required to generate data from the proposed study.
Required if the proposed study is specified through the <code>study</code>
argument, but not if it is specified through the <code>datagen_fn</code>
argument.</p>
<p>For example, if <code>study = "trial_binary"</code> is specified, then
<code>pars_datagen</code> should be a vector of two elements naming the probability of
the outcome in arm 1 and arm 2 respectively.</p>
<p>If <code>pars_datagen</code> is not supplied, then it is assumed to be the same as <code>pars</code>.
Note that these can be different.  Even if the study data are generated by a particular parameter,
when analysing the data we could choose to ignore the information that the data provides about
that parameter.</p></dd>


<dt>n</dt>
<dd><p>Sample size of future study, or vector of alternative sample sizes.
This is understood by the built-in study designs.  For studies specified
by the user with <code>datagen_fn</code>, if <code>datagen_fn</code> has an argument
<code>n</code>, then this is interpreted as the sample size. Currently this
shortcut is not supported if more than one quantity is required to
describe the sample size, for example, trials with unbalanced arms.  In
that case, you will have to hard-code the required sample sizes into
<code>datagen_fn</code>.</p>
<p>For the nonparametric regression and importance sampling methods, the
computation is simply repeated for each sample size supplied here.</p>
<p>The moment matching method uses a regression model to estimate the
dependency of the EVSI on the sample size, hence to enable EVSI to be
calculated efficiently for any number of sample sizes (Heath et al. 2019).</p></dd>


<dt>aux_pars</dt>
<dd><p>A list of additional fixed arguments to supply to the
function to generate the data, whether that is a built-in or user-defined
function, e.g. <code>evsi(..., aux_pars = list(sd=2))</code> to change the fixed
standard deviation in the <code>"normal_known"</code> model.</p></dd>


<dt>method</dt>
<dd><p>Character string indicating the calculation method.</p>
<p>All the nonparametric regression methods supported for
<code><a href="evppi.html">evppi</a></code>, that is <code>"gam","gp","earth","inla"</code>, can also be
used for EVSI calculation by regressing on a summary statistic of the
predicted data (Strong et al 2015).   Defaults to <code>"gam"</code>.</p>
<p><code>"is"</code> for importance sampling (Menzies 2016)</p>
<p><code>"mm"</code> for moment matching (Heath et al 2018) (experimental and only
partially implemented)</p>
<p>Note that the  <code>"is"</code> and <code>"mm"</code> methods are used in conjunction
with nonparametric regression, thus the <code>gam_formula</code> argument can be
supplied to <code>evsi</code> to specify this regression - see
<code><a href="evppi.html">evppi</a></code>.</p></dd>


<dt>likelihood</dt>
<dd><p>Likelihood function, required (and only required) for the
importance sampling method when a study design other than one of the
built-in ones is used.  This should have two arguments as follows:</p><ol><li><p>a data frame of predicted data. Columns are defined by the number of
outcomes in the data, and names matching the data frame returned by
<code>datagen_fn</code>.</p></li>
<li><p>a data frame of parameter values, whose names should all correspond to
variables in <code>inputs</code>.</p></li>
</ol><p>The function should return a vector whose length matches the number of
rows of the parameters data frame given as the second argument.   Each
element of the vector gives the likelihood of the corresponding set of
parameters, given the data in the first argument.  An example is given in
the vignette.</p>
<p>Note the definition of the likelihood should agree with the definition of
<code>datagen_fn</code> to define a consistent sampling distribution for the
data.</p></dd>


<dt>analysis_fn</dt>
<dd><p>Function which fits a Bayesian model to the generated
data.   Required for <code>method="mm"</code> if a study design other than one
of the built-in ones is used.  This should be a function that takes the
following arguments:</p>
<p><code>data</code>: A data frame with names matching the output of <code>datagen_fn</code></p>
<p><code>args</code>: A list with constants required in the Bayesian analysis, e.g.
prior parameters, or options for the analysis, e.g. number of MCMC
simulations. The component of this list called <code>n</code> is assumed to
contain the sample size of the study.</p>
<p><code>pars</code> Names of the parameters whose posterior is being sampled.</p>
<p>The function should return a data frame with names matching <code>pars</code>,
containing a sample from the posterior distribution of the parameters
given data supplied through <code>data</code>.</p>
<p><code>analysis_fn</code> is required to have all three of these arguments, but you do
not need to use any elements of <code>args</code> or <code>pars</code> in the body of
<code>analysis_fn</code>.  Instead, sample sizes, prior parameters, MCMC options and
parameter names can be hard-coded inside <code>analysis_fn</code>. Passing these
through the function arguments (via the <code>analysis_args</code> argument to
<code>evsi</code>) is only necessary if we want to use the same <code>analysis_fn</code> to
do EVSI calculations with different sample sizes or other settings.</p></dd>


<dt>analysis_args</dt>
<dd><p>List of arguments required for the Bayesian analysis of
the predicted data, e.g. definitions of the prior and options to control
sampling.  Only used in <code>method="mm"</code>.  This is required if the study
design is one of the built-in ones specified in <code>study</code>.  If a custom
design is specifed through <code>analysis_fn</code>, then any constants needed
in <code>analysis_fn</code> can either be supplied in <code>analysis_args</code>, or hard-coded
in <code>analysis_fn</code> itself.</p>
<p>For the built-in designs, the lists should have the following named
components. An optional component <code>niter</code> in each case defines the
posterior sample size (default 1000).</p>
<p><code>study="binary"</code>: <code>a</code> and <code>b</code>: Beta shape parameters</p>
<p><code>study="trial_binary"</code>: <code>a1</code> and <code>b1</code>: Beta shape parameters for the prior
for the first arm,  <code>a2</code> and <code>b2</code>: Beta shape parameters for the prior for
the second arm.</p>
<p><code>study="normal_known"</code>: <code>prior_mean</code>, <code>prior_sd</code> (prior mean and standard
deviation) and <code>sampling_sd</code> (SD of an individual-level normal
observation, so that the sampling SD of the mean outcome over the study is
<code>sampling_sd/sqrt(n)</code>.</p></dd>


<dt>model_fn</dt>
<dd><p>Function which evaluates the decision-analytic model, given
parameter values.  Required for <code>method="mm"</code>.  See
<code><a href="evppi_mc.html">evppi_mc</a></code> for full specification.</p></dd>


<dt>par_fn</dt>
<dd><p>Function to simulate values from the uncertainty distributions
of parameters needed by the decision-analytic model.  Should take one
argument and return a data frame with one row for each simulated value,
and one column for each parameter.  See <code><a href="evppi_mc.html">evppi_mc</a></code> for full
specification.</p></dd>


<dt>Q</dt>
<dd><p>Number of quantiles to use in <code>method="mm"</code>.</p></dd>


<dt>npreg_method</dt>
<dd><p>Method to use to calculate the EVPPI, for those methods
that require it.  This is passed to <code><a href="evppi.html">evppi</a></code> as the
<code>method</code> argument.</p></dd>


<dt>nsim</dt>
<dd><p>Number of simulations from the model to use for calculating
EVPPI.  The first <code>nsim</code> rows of the objects in <code>inputs</code> and
<code>outputs</code> are used.</p></dd>


<dt>verbose</dt>
<dd><p>If <code>TRUE</code>, then messages are printed describing each step of
the calculation, if the method supplies these.  Useful to see the progress
of slow calculations.</p></dd>


<dt>check</dt>
<dd><p>If <code>TRUE</code>, then extra information about the estimation
is saved inside the object that this function returns.  This currently
only applies to the regression-based methods <code>"gam"</code> and <code>"earth"</code>
where the fitted regression model objects are saved.  This allows use
of the <code><a href="check_regression.html">check_regression</a></code> function, which produces some
diagnostic checks of the regression models.</p></dd>


<dt>...</dt>
<dd><p>Other arguments required by specific methods</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Strong, M., Oakley, J. E., Brennan, A., &amp; Breeze, P. (2015). Estimating the
expected value of sample information using the probabilistic sensitivity
analysis sample: a fast, nonparametric regression-based method. Medical
Decision Making, 35(5), 570-583.</p>
<p>Menzies, N. A. (2016). An efficient estimator for the expected value of
sample information. Medical Decision Making, 36(3), 308-320.</p>
<p>Heath, A., Manolopoulou, I., &amp; Baio, G. (2018). Efficient Monte Carlo
estimation of the expected value of sample information using moment
matching. Medical Decision Making, 38(2), 163-173.</p>
<p>Heath, A., Manolopoulou, I., &amp; Baio, G. (2019). Estimating the expected
value of sample information across different sample sizes using moment
matching and nonlinear regression. Medical Decision Making, 39(4), 347-359.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Christopher Jackson, Anna Heath.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

